

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Excursion: The Teeworlds map format &mdash; tml v0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="tml v0.1.0 documentation" href="index.html" />
    <link rel="prev" title="Teemap" href="teemap.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="teemap.html" title="Teemap"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">tml v0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="excursion-the-teeworlds-map-format">
<h1>Excursion: The Teeworlds map format<a class="headerlink" href="#excursion-the-teeworlds-map-format" title="Permalink to this headline">¶</a></h1>
<p>In this chapter you will learn how a teeworlds map is structured. This
knowledge is not necessary for using tml, but it can be helpfull if you are
interested in understanding what is going on under the hood or just want
to hack a map yourself.</p>
<div class="section" id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h2>
<p>The first bytes just contain the word &#8220;DATA&#8221; or &#8220;ATAD&#8221; (little oder big endian),
it is the &#8220;signature&#8221; of a teeworlds map. After that there is an int which
contains the version of the mapformat, teeworlds 0.5 uses version 4 but also
supports 3, this libary only supports 4.</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">DATA\\x04\\x00\\x00\\x00</span></tt></div></blockquote>
<p>Then there are four more ints which can be read straight from the file.
These are &#8220;size&#8221;, &#8220;swaplen&#8221;, &#8220;num_item_types&#8221;, &#8220;num_items&#8221;, &#8220;num_raw_data&#8221;,
&#8220;item_size&#8221; and &#8220;data_size&#8221;.</p>
<p>Now the size of the whole header can be calculated. This is important to
skip the header and go directly to the items and datas themself. It is the sum
of the following:</p>
<ul class="simple">
<li>num_item_types * 12 (one item type is composed of three int, one int is four
bits)</li>
<li>(num_items + num_raw_data) * 4</li>
<li>num_raw_data * 4</li>
<li>item_size</li>
</ul>
</div>
<div class="section" id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<p>After the header the types are stored. For each item type there is a list
containing the type, the number of items for this type and which itme is the
first for this type.</p>
</div>
<div class="section" id="item-offsets">
<h2>Item offsets<a class="headerlink" href="#item-offsets" title="Permalink to this headline">¶</a></h2>
<p>Right after the types the item offsets are stored. The first offset is 0. The
offset to the next item will be the size of the previous item. The size of each
item is as big as defined in <cite>mapitems.h</cite> (see teeworlds source) plus 2 more
integers containing the type, id and the item size. Type and id is within the
first integer.
There is always one &#8220;envpoint&#8221; item with a dynamic size. It consists of the 2
integers and type size multiplicated with the number of envpoints.</p>
</div>
<div class="section" id="uncompressed-data-sizes">
<h2>Uncompressed data sizes<a class="headerlink" href="#uncompressed-data-sizes" title="Permalink to this headline">¶</a></h2>
<p>The uncompressed data sizes are stored after the item offsets. The sizes are
used to allocate the memory for each data in teeworlds.</p>
</div>
<div class="section" id="items">
<h2>Items<a class="headerlink" href="#items" title="Permalink to this headline">¶</a></h2>
<p>Finally the items are stored. Every item will be stored with all its data in
this order:</p>
<ol class="arabic simple">
<li>version</li>
<li>images</li>
<li>envelops</li>
<li>groups</li>
<li>layers</li>
<li>envpoints</li>
</ol>
</div>
<div class="section" id="compressed-data">
<h2>Compressed data<a class="headerlink" href="#compressed-data" title="Permalink to this headline">¶</a></h2>
<p>Eventually the compressed data is stored. Image- and tilelayers have an index
which tells the position of the corresponding data.
The compressed data part stores image names, tiles, quads and embedded images.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Excursion: The Teeworlds map format</a><ul>
<li><a class="reference internal" href="#header">Header</a></li>
<li><a class="reference internal" href="#types">Types</a></li>
<li><a class="reference internal" href="#item-offsets">Item offsets</a></li>
<li><a class="reference internal" href="#uncompressed-data-sizes">Uncompressed data sizes</a></li>
<li><a class="reference internal" href="#items">Items</a></li>
<li><a class="reference internal" href="#compressed-data">Compressed data</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="teemap.html"
                        title="previous chapter">Teemap</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/mapformat.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="teemap.html" title="Teemap"
             >previous</a> |</li>
        <li><a href="index.html">tml v0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2011, TML Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>